{
  "hash": "190e30c73ef5f6dcb7d5bb6e84d01a87",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"RRR: Mediation makes my head hurt!\"\nauthor: \"Jon Brauer\"\ndate: \"2024-05-13\"\nimage: thinking_hurts.jpeg\nimage-alt: \"Mediation makes my head hurt\"\ndescription: \"Our first Reluctantly Rapid Response (RRR) post addresses a confusing mediation issue.\"\ncitation:\n  url: https://reluctantcriminologists.com/blog-posts/[12]/rrr_mediation.html\ncategories: [general, rstats, causality, mediation]\n# https://community.rstudio.com/t/quarto-how-to-cross-reference-unnumbered-book-chapter/136279/2\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show code\"\nexecute: \n  warning: false\ndraft: false\n---\n\n\n![Mediation makes my head hurt](thinking_hurts.jpeg)\n\n## Motivation\n\nAt times, we find ourselves wanting to publish a brief or \"quick hitting\" entry with a brief comment or coding example but do not have the time for a formal blog post. So, we decided to pilot a new type of entry. For lack of a better term, we'll call this a \"Reluctantly Rapid Response\" (RRR for short). We are generally reluctant to post anything and doubly reluctant to post anything rapidly, so the name seems fitting to us. \n\nThis RRR entry provides code and output from a simple simulation motivated by [Brier Gallihugh's](https://twitter.com/Brier_Gallihugh) [question on X](https://x.com/Brier_Gallihugh/status/1789398630425649302) about a mediation issue. \n\n![A mediation mystery unfolds](BG_tweet.jpeg)\n\nThe following simulation, plots, and analysis provide one example situation in which changes in a mediator (ChgM) are positively correlated with changes in an outcome (ChgY) within two groups A & B, yet Group A membership is estimated as having a negative indirect effect on changes in the outcome (ChgY) via changes in the mediator (ChgM). In this example, the total negative indirect effect is generated by a small negative \"pure\" indirect (PNIE) effect combined with a small \"mediated interaction\" (INTmed) effect. \n\nI am not claiming that this is what is happening in the original poster's (BG's) data. In fact, one apparent and important difference is that BG stated in a later tweet that \"Group A shows higher rates of their mediator compared to Group B AND lower rates of the outcome compared to Group B as well.\" \n\n![The probability plot thickens](BG_tweet2.jpeg)\n\nIf \"rates\" refer to initial status at Time 1 (not changes), then perhaps we could generate comparable data. Yet, if \"rates\" refers to the change scores themselves, then it seems we may still have an unsolved problem on our hands. In the simulation below, changes in the mediator are positively correlated with changes in the outcome in both Groups A and B, and Group A has lower outcome change scores on average; however, specification of marginally lower mediator change scores on average for Group A contribute to the negative indirect effect estimates. \n\nPlease feel free to reach out on X or via email if you see errors or have other suggestions! \n\n## Load libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(patchwork)\nlibrary(psych)\n# library(devtools)\n# install_github(\"jtextor/dagitty/r\")\nlibrary(dagitty)\nlibrary(CMAverse)\n```\n:::\n\n\n## Basic DAG\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSimpsonDAG <- dagitty(\"dag{\n  GroupA -> ChgM -> ChgY\n  GroupA -> ChgY\n   }\") \ncoordinates(SimpsonDAG) <- list(\n  x=c(GroupA=1, ChgM=2, ChgY=3),\n  y=c(GroupA=2, ChgM=1, ChgY=2) )\n\nplot(SimpsonDAG)\n```\n\n::: {.cell-output-display}\n![](RRR_mediation_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Simulate data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1138)\nn <- 500\nGroupA<-rbinom(n=1000,size=1,prob=0.50)\nChgM <- -.1*GroupA + rnorm(n)\nChgY <- .5*ChgM + -.5*GroupA + .4*GroupA*ChgM + rnorm(n)\nsimdata <- tibble(GroupA, ChgM, ChgY)\n\nsimdata\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1,000 × 3\n   GroupA   ChgM    ChgY\n    <int>  <dbl>   <dbl>\n 1      0 -0.358  0.687 \n 2      0 -0.490 -2.07  \n 3      0 -0.115  0.895 \n 4      1 -0.451 -1.65  \n 5      1 -0.588 -1.31  \n 6      0 -0.961  0.371 \n 7      1 -0.732 -1.51  \n 8      1  0.294 -0.344 \n 9      0 -0.249  0.0797\n10      1 -2.42  -2.25  \n# ℹ 990 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nGroupAplot <- simdata %>% ggplot() +\n  geom_bar(aes(x=GroupA),\n                 color=\"#1fa187\", fill=\"#4ac16d\", alpha=.7,\n                 position=\"identity\") + \n  theme_minimal() + \n  theme(axis.text.y=element_blank(),  \n        axis.ticks.y=element_blank()\n        ) +\n  labs(x=\"GroupA\", y=NULL)\n\nChgMplot <- simdata %>% ggplot() +\n  geom_histogram(aes(x=ChgM, y=..density..),\n                 color=\"#1fa187\", fill=\"#4ac16d\", alpha=.7,\n                 position=\"identity\", \n                 breaks = seq(-4, 4, by = 1)) + \n  theme_minimal() + \n  theme(axis.text.y=element_blank(),  \n        axis.ticks.y=element_blank()\n        ) +\n  labs(x=\"ChgM\", y=NULL)\n\nChgYplot <- simdata %>% ggplot() +\n  geom_histogram(aes(x=ChgY, y=..density..),\n                 color=\"#1fa187\", fill=\"#4ac16d\", alpha=.7,\n                 position=\"identity\") + \n  theme_minimal() + \n  theme(axis.text.y=element_blank(),  \n        axis.ticks.y=element_blank()\n        ) +\n  labs(x=\"ChgY\", y=NULL)\n\n\nGroupAplot + ChgMplot + ChgYplot\n```\n\n::: {.cell-output-display}\n![](RRR_mediation_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## Bivariate corrs\n\n### Full sample\n\nPositive correlation between ChgM and ChgY in full sample.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs.panels(simdata,\n             smooth = FALSE,      # If TRUE, draws loess smooths\n             scale = FALSE,      # If TRUE, scales the correlation text font\n             density = TRUE,     # If TRUE, adds density plots and histograms\n             ellipses = FALSE,    # If TRUE, draws ellipses\n             method = \"pearson\", # Correlation method (also \"spearman\" or \"kendall\")\n             pch = 21,           # pch symbol\n             lm = TRUE,         # If TRUE, plots linear fit rather than the LOESS (smoothed) fit\n             cor = TRUE,         # If TRUE, reports correlations\n             jiggle = FALSE,     # If TRUE, data points are jittered\n             factor = 2,         # Jittering factor\n             hist.col = 3,       # Histograms color\n             stars = TRUE,       # If TRUE, adds significance level with stars\n             ci = TRUE)          # If TRUE, adds confidence intervals\n```\n\n::: {.cell-output-display}\n![](RRR_mediation_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Group A only \n\nPositive correlation between ChgM and ChgY within Group A.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdataA <- simdata %>% filter(GroupA==1) %>% select(-GroupA)\npairs.panels(simdataA, density = TRUE, method = \"pearson\", pch = 21, \n             lm = TRUE, cor = TRUE, hist.col = 3, stars = TRUE, ci = TRUE)  \n```\n\n::: {.cell-output-display}\n![](RRR_mediation_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Group B only \n\nPositive correlation between ChgM and ChgY within Group B.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdataB <- simdata %>% filter(GroupA==0) %>% select(-GroupA)\npairs.panels(simdataB, density = TRUE, method = \"pearson\", pch = 21, \n             lm = TRUE, cor = TRUE, hist.col = 3, stars = TRUE, ci = TRUE)  \n```\n\n::: {.cell-output-display}\n![](RRR_mediation_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## Scatterplot by group\n\nNotice inconsistent or heterogeneous effect of ChgM on ChgY across Groups. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = simdata, aes(x = ChgM, y = ChgY)) +\n        geom_point(aes(shape = factor(GroupA))) +\n        geom_point(aes(color = factor(GroupA))) +\n        geom_smooth(method = \"lm\", \n                    se = FALSE, \n                    aes(color = factor(GroupA))) \n```\n\n::: {.cell-output-display}\n![](RRR_mediation_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n## Simple mediation model\n\nNegative indirect effect of GroupA on ChgY via ChgM.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmediate(ChgY ~ GroupA + (ChgM), data = simdata, n.iter = 10000) %>% print(short = TRUE)\n```\n\n::: {.cell-output-display}\n![](RRR_mediation_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nMediation/Moderation Analysis \nCall: mediate(y = ChgY ~ GroupA + (ChgM), data = simdata, n.iter = 10000)\n\nThe DV (Y) was  ChgY . The IV (X) was  GroupA . The mediating variable(s) =  ChgM .\n\nTotal effect(c) of  GroupA  on  ChgY  =  -0.62   S.E. =  0.08  t  =  -8.07  df=  998   with p =  2e-15\nDirect effect (c') of  GroupA  on  ChgY  removing  ChgM  =  -0.53   S.E. =  0.06  t  =  -8.47  df=  997   with p =  8.5e-17\nIndirect effect (ab) of  GroupA  on  ChgY  through  ChgM   =  -0.08 \nMean bootstrapped indirect effect =  -0.08  with standard error =  0.04  Lower CI =  -0.17    Upper CI =  0\nR = 0.61 R2 = 0.37   F = 289.17 on 2 and 997 DF   p-value:  5.13e-135 \n\n To see the longer output, specify short = FALSE in the print statement or ask for the summary\n```\n\n\n:::\n:::\n\n\n## Mediation model accounting for exposure-mediator interaction\n\nTotal negative indirect effect (PNIE + INTmed) estimate is larger after accounting for exposure-mediator interaction. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1138)\nest <- cmest(data = simdata, model = \"rb\", outcome = \"ChgY\", exposure = \"GroupA\",\n                mediator = \"ChgM\", EMint = TRUE,\n                mreg = list(\"linear\"), yreg = \"linear\",\n                astar = 0, a = 1, mval = list(0),\n                estimation = \"imputation\", inference = \"bootstrap\", nboot = 20)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(est)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCausal Mediation Analysis\n\n# Outcome regression:\n\nCall:\nglm(formula = ChgY ~ GroupA + ChgM + GroupA * ChgM, family = gaussian(), \n    data = getCall(x$reg.output$yreg)$data, weights = getCall(x$reg.output$yreg)$weights)\n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  0.03308    0.04337   0.763    0.446    \nGroupA      -0.51010    0.06229  -8.190 7.97e-16 ***\nChgM         0.53021    0.04329  12.248  < 2e-16 ***\nGroupA:ChgM  0.34764    0.06259   5.554 3.58e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 0.9610836)\n\n    Null deviance: 1559.35  on 999  degrees of freedom\nResidual deviance:  957.24  on 996  degrees of freedom\nAIC: 2804.2\n\nNumber of Fisher Scoring iterations: 2\n\n\n# Mediator regressions: \n\nCall:\nglm(formula = ChgM ~ GroupA, family = gaussian(), data = getCall(x$reg.output$mreg[[1L]])$data, \n    weights = getCall(x$reg.output$mreg[[1L]])$weights)\n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)  \n(Intercept) -0.006556   0.043905  -0.149   0.8813  \nGroupA      -0.120841   0.062786  -1.925   0.0546 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 0.9850333)\n\n    Null deviance: 986.71  on 999  degrees of freedom\nResidual deviance: 983.06  on 998  degrees of freedom\nAIC: 2826.8\n\nNumber of Fisher Scoring iterations: 2\n\n\n# Effect decomposition on the mean difference scale via the regression-based approach\n \nDirect counterfactual imputation estimation with \n bootstrap standard errors, percentile confidence intervals and p-values \n \n              Estimate Std.error   95% CIL 95% CIU  P.val    \ncde          -0.510101  0.073753 -0.651063  -0.410 <2e-16 ***\npnde         -0.514441  0.074196 -0.638106  -0.410 <2e-16 ***\ntnde         -0.556449  0.076406 -0.692366  -0.431 <2e-16 ***\npnie         -0.064071  0.034397 -0.126845  -0.011 <2e-16 ***\ntnie         -0.106080  0.056820 -0.194148  -0.019 <2e-16 ***\nte           -0.620520  0.089392 -0.778236  -0.465 <2e-16 ***\nintref       -0.004339  0.015854 -0.029367   0.025    0.8    \nintmed       -0.042009  0.025189 -0.095535  -0.008 <2e-16 ***\ncde(prop)     0.822054  0.068527  0.730253   0.935 <2e-16 ***\nintref(prop)  0.006993  0.025298 -0.042487   0.047    0.8    \nintmed(prop)  0.067700  0.035646  0.017009   0.143 <2e-16 ***\npnie(prop)    0.103254  0.047652  0.021586   0.183 <2e-16 ***\npm            0.170953  0.078667  0.038596   0.283 <2e-16 ***\nint           0.074693  0.031196  0.022878   0.120 <2e-16 ***\npe            0.177946  0.068527  0.064943   0.270 <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(cde: controlled direct effect; pnde: pure natural direct effect; tnde: total natural direct effect; pnie: pure natural indirect effect; tnie: total natural indirect effect; te: total effect; intref: reference interaction; intmed: mediated interaction; cde(prop): proportion cde; intref(prop): proportion intref; intmed(prop): proportion intmed; pnie(prop): proportion pnie; pm: overall proportion mediated; int: overall proportion attributable to interaction; pe: overall proportion eliminated)\n\nRelevant variable values: \n$a\n[1] 1\n\n$astar\n[1] 0\n\n$mval\n$mval[[1]]\n[1] 0\n```\n\n\n:::\n:::\n",
    "supporting": [
      "RRR_mediation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}