<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jon Brauer">
<meta name="dcterms.date" content="2024-01-30">
<meta name="description" content="Is your mechanism both mediating and moderating? Disentangle indirect and interaction effects with potential outcomes decomposition.">

<title>reluctant criminologists - Moderator Madness, Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-F0XQR72SS3"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-F0XQR72SS3', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/RC_banner.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">reluctant criminologists</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog-posts.html" rel="" target="">
 <span class="menu-text">blog posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../course-materials.html" rel="" target="">
 <span class="menu-text">course materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog-posts/[2]/favorite_links.html" rel="" target="">
 <span class="menu-text">links we love</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:reluctantcrim@gmail.com" rel="" target=""><i class="bi bi-envelope-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jakeday4/reluctantcrim_website" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/reluctantcrim" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section-a-counterfactuals-potential-outcomes-and-effect-decomposition" id="toc-section-a-counterfactuals-potential-outcomes-and-effect-decomposition" class="nav-link active" data-scroll-target="#section-a-counterfactuals-potential-outcomes-and-effect-decomposition">Section A: Counterfactuals, potential outcomes, and effect decomposition</a>
  <ul class="collapse">
  <li><a href="#comprehending-counterfactuals" id="toc-comprehending-counterfactuals" class="nav-link" data-scroll-target="#comprehending-counterfactuals">Comprehending counterfactuals</a></li>
  <li><a href="#prepare-for-potential-outcomes-notation" id="toc-prepare-for-potential-outcomes-notation" class="nav-link" data-scroll-target="#prepare-for-potential-outcomes-notation">Prepare for potential outcomes notation</a></li>
  <li><a href="#is-your-mechanism-a-mediator-a-moderator-or-both" id="toc-is-your-mechanism-a-mediator-a-moderator-or-both" class="nav-link" data-scroll-target="#is-your-mechanism-a-mediator-a-moderator-or-both">Is your mechanism a mediator, a moderator, or both?</a></li>
  <li><a href="#four-way-decomposition-with-toy-example" id="toc-four-way-decomposition-with-toy-example" class="nav-link" data-scroll-target="#four-way-decomposition-with-toy-example">Four-way decomposition with toy example</a></li>
  </ul></li>
  <li><a href="#section-b.-simulated-effect-decomposition-with-cmaverse" id="toc-section-b.-simulated-effect-decomposition-with-cmaverse" class="nav-link" data-scroll-target="#section-b.-simulated-effect-decomposition-with-cmaverse">Section B. Simulated Effect Decomposition with CMAverse</a>
  <ul class="collapse">
  <li><a href="#simulation-and-causal-mediation-assumptions" id="toc-simulation-and-causal-mediation-assumptions" class="nav-link" data-scroll-target="#simulation-and-causal-mediation-assumptions">Simulation and “causal mediation” assumptions</a></li>
  <li><a href="#terminology" id="toc-terminology" class="nav-link" data-scroll-target="#terminology">Terminology</a></li>
  <li><a href="#simulate-data" id="toc-simulate-data" class="nav-link" data-scroll-target="#simulate-data">Simulate data</a></li>
  <li><a href="#regression-plot" id="toc-regression-plot" class="nav-link" data-scroll-target="#regression-plot">Regression &amp; Plot</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Moderator Madness, Part 2</h1>
  <div class="quarto-categories">
    <div class="quarto-category">general</div>
    <div class="quarto-category">rstats</div>
    <div class="quarto-category">causality</div>
    <div class="quarto-category">moderation</div>
    <div class="quarto-category">mediation</div>
  </div>
  </div>

<div>
  <div class="description">
    Is your mechanism both mediating and moderating? Disentangle indirect and interaction effects with potential outcomes decomposition.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jon Brauer </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 30, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="med-or-mod-cartoon2.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Two lemmings confused by exposure-mediator interactions (with help from DALL-E)</figcaption>
</figure>
</div>
<p>In <a href="https://reluctantcriminologists.com/blog-posts/%5B6%5D/modmadness-pt1.html">Part 1</a>, I covered issues related to estimating and interpreting interaction effects with binary or skewed count outcome variables. In Part 2, I introduce the need and a method for disentangling indirect and interaction effects in the presence of a potential exposure-mediator interaction.</p>
<p>My primary goals in this post are to (1) introduce counterfactual causality, exposure-mediator interactions, and key terminology and logic underlying a “causal mediation” approach to decomposing total effects within a potential outcomes framework; and (2) illustrate how to conduct total effect decomposition using simulated crime data with the <code>CMAverse</code> software package in R and introduce the important assumptions required to interpret the generated model parameters as estimates of causal effects.</p>
<p>Ready to dip your toes into the deep end?</p>
<section id="section-a-counterfactuals-potential-outcomes-and-effect-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="section-a-counterfactuals-potential-outcomes-and-effect-decomposition">Section A: Counterfactuals, potential outcomes, and effect decomposition</h2>
<section id="comprehending-counterfactuals" class="level3">
<h3 class="anchored" data-anchor-id="comprehending-counterfactuals">Comprehending counterfactuals</h3>
<p>Have you ever stubbed your toe in the dark? Think back to one of those times. Did you say “ouch” or some other four letter word? What do you think <strong>caused</strong> you to stub your toe?</p>
<p>Let’s add some details to this example: Imagine that you are in an unfamiliar room, at night, with blackout curtains drawn closed over a single window. With the curtains closed, the room lacks sufficient light to help you see obstacles in your path. You are tip-toing across the room in search of a light switch when suddenly - “OUCH!” - you stub your toe on what feels like the leg of a chair. Your mind suddenly and angrily turns to the curtains: “If I had just left those #&amp;%@! curtains open, I never would have stubbed my toe!”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="counterfac1.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Your thoughts communicate a causal claim about the world - that the closed window curtain caused your pain.</figcaption>
</figure>
</div>
<p>There are two important things to note about this imaginary angry thought. First, it communicates a causal belief or claim. Specifically, your momentary thought communicates a belief that the closed window curtains are (at least partly) responsible for you stubbing your toe. Put differently, you view the closed curtains as a <em>cause</em> of the undesired outcome - perhaps not the only cause, but a noteworthy cause nonetheless.</p>
<p>Second, the structure of this angry thought conveys an implicit view of causal claims as dependent upon contrasts between plausible “potential outcomes” across observed and “counterfactual” conditions. That is, your momentary thought contrasts an observed or factual initial condition (the closed curtain) with a <em>counterfactual</em> initial condition (an open curtain), and then implies a different potential outcome (i.e, a stubbed versus an unstubbed toe) might have occurred if the observed initial condition would have been changed to the counterfactual condition instead.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="counterfac2.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Causal claims depend upon contrasts between “potential outcomes” across observed and counterfactual conditions.</figcaption>
</figure>
</div>
<p>Many social scientific questions and claims reflect a similar counterfactual logic or, at least, can be recast in counterfactual terms:</p>
<ul>
<li><em>If politicians had not campaigned on these platforms or had not signed those policies into law, then US incarceration rates would not have increased exponentially…</em></li>
<li><em>If we intervene in those neighborhoods in these ways, then crime rates in those neighborhoods will reduce…</em></li>
<li><em>If that group had those different characteristics, then they would have received better (worse) criminal justice outcomes…</em><br>
</li>
<li><em>If those adults had not experienced adverse childhood experiences, then they might not have participated in violent criminal behaviors…</em></li>
</ul>
<p>In our <a href="https://reluctantcriminologists.com/blog-posts/%5B4%5D/causation-no-corr">earlier post on causation without correlation</a>, we also noted that counterfactual reasoning is central to statistical tests of causal claims and even underlies justifications for randomized controlled trials themselves:</p>
<blockquote class="blockquote">
<p>“We seem to engage in counterfactual thinking naturally, as it appears central to <a href="https://plato.stanford.edu/entries/counterfactuals/">imagination and rational agency</a>. Pearl and Mackenzie go so far as to claim that the ability to use counterfactual thinking to make “explanation-seeking inferences reliably and repeatably” is what “most distinguishes human from animal intelligence, as well as from model-blind versions of AI and machine learning” (<a href="https://www.basicbooks.com/titles/judea-pearl/the-book-of-why/9780465097616/">2018</a>, p.33). Moreover, the belief that randomization in controlled experiments offers a valid mechanism for making causal inferences relies upon counterfactual reasoning about potential outcomes; these counterfactual justifications underlying classical statistics were proposed by pioneers Jersey Neyman and Sir Ronald Fisher <a href="https://www.cambridge.org/core/books/abs/causal-inference-for-statistics-social-and-biomedical-sciences/brief-history-of-the-potential-outcomes-approach-to-causal-inference/B8CEDDC08F0E0D6C577847F0CBE4E6A3">a century ago</a>! Meanwhile, principled counterfactual frameworks using potential outcomes to make causal inferences with observational data have been in use <a href="https://en.wikipedia.org/wiki/Rubin_causal_model">since the 1970s</a> and represent arguably <a href="https://jech.bmj.com/content/76/11/960">the best approach to causal identification with observational data today</a>.”</p>
</blockquote>
</section>
<section id="prepare-for-potential-outcomes-notation" class="level3">
<h3 class="anchored" data-anchor-id="prepare-for-potential-outcomes-notation">Prepare for potential outcomes notation</h3>
<p>With that said, let’s recast our hypothetical toe-stubbing example into the language of counterfactuals and potential outcomes.</p>
<p>In this simple example, we have two initial “exposure” or “treatment” conditions: <em>curtains closed</em> and <em>curtains open</em>. We will denote <em>curtains open</em> as X=0 and <em>curtains closed</em> as X=1. Likewise, we have two “potential outcome” conditions: <em>unstubbed toe</em>, denoted as Y=0, and <em>stubbed toe</em>, denoted as Y=1.</p>
<p>Given these and our causal expectations, we can write two potential outcomes equations, Y(0)=0 (or Y0=0) and Y(1)=1 (or Y1=1), that respectively represent our expectation of a <em>stubbed toe</em> when curtains are closed and our expectation of an <em>unstubbed toe</em> when curtains are open. Here, I am (loosely) adopting <a href="http://causality.cs.ucla.edu/blog/index.php/2013/10/26/comments-on-kennys-summary-of-causal-mediation/">Pearl’s <em>do-calculus</em> notation</a>, where these two equations are abbreviations of longer structural equations for outcome probability expectations under different initial conditions where we <em>do</em> X=0 or X=1. The first equation, Y(0), is shorthand for Y(do[x=0])=0, which means that we expect the value of Y to equal “0” (i.e., we expect an unstubbed toe) when we <em>do</em> X=0 (i.e., when we open the curtains). Similarly, the second equation, Y(1), is shorthand for Y(do[x=1])=1, which means that we expect the value of Y to be “1” (i.e., we expect a stubbed toe) when we <em>do</em> X=1 (i.e., when we close the curtains). Technically, we expect the probability to be closer to zero or one when we do X=0 or X=1, respectively, but just bear with me here.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="counterfac3.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">We can recast our thought experiment into the language of potential outcomes.</figcaption>
</figure>
</div>
<p>Additionally, <a href="https://reluctantcriminologists.com/blog-posts/%5B5%5D/colliders#sec-dagsaber">as we have explained before</a>, it is usually helpful to communicate our causal assumptions transparently using a causal diagram or a DAG. In the DAG below, we collapse our exposure conditions and potential outcomes into two variables connected by an arrow to represent our expectation of a causal relationship between curtains (open versus closed) and uttering a four-letter word (unstubbed versus stubbed toe).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simstudy)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://cran.r-project.org/web/packages/simstudy/vignettes/simstudy.html</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://kgoldfeld.github.io/simstudy/articles/simstudy.html</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(psych) #detach to ensure alpha works with ggplot</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># library(devtools)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># install_github("jtextor/dagitty/r")</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(truncnorm)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(see)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># devtools::install_github("strengejacke/strengejacke")</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sjPlot"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggthemes"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"margins"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggdist"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CMAverse)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ouchDAG <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  Ouch <span class="sc">~</span> Curtains,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Curtains"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Ouch"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords=</span><span class="fu">list</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="fu">c</span>(<span class="at">Curtains=</span><span class="dv">0</span>, <span class="at">Ouch=</span><span class="dv">2</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(<span class="at">Curtains =</span><span class="dv">1</span>, <span class="at">Ouch=</span><span class="dv">1</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">tidy_dagitty</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">focal =</span> <span class="fu">ifelse</span>(name <span class="sc">!=</span> <span class="st">"Curtains"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#CC79A7"</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#function to shorten arrows (edges)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/65420136/how-do-you-adjust-the-arrows-in-a-ggplot-of-a-ggdag</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>shorten_dag_arrows <span class="ot">&lt;-</span> <span class="cf">function</span>(tidy_dag, proportion){</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Update underlying ggdag object</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>tidy_dag<span class="sc">$</span>data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(tidy_dag<span class="sc">$</span>data, </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">xend =</span> (<span class="dv">1</span><span class="sc">-</span>proportion<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>(xend <span class="sc">-</span> x) <span class="sc">+</span> x, </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">yend =</span> (<span class="dv">1</span><span class="sc">-</span>proportion<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>(yend <span class="sc">-</span> y) <span class="sc">+</span> y,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">xstart =</span> (<span class="dv">1</span><span class="sc">-</span>proportion<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>(x <span class="sc">-</span> xend) <span class="sc">+</span> xend,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ystart =</span> (<span class="dv">1</span><span class="sc">-</span>proportion<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>(y<span class="sc">-</span>yend) <span class="sc">+</span> yend)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(tidy_dag)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>ouchDAG1 <span class="ot">&lt;-</span> <span class="fu">shorten_dag_arrows</span>(ouchDAG, <span class="fl">0.08</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>ouchDAG1 <span class="ot">&lt;-</span> ouchDAG1 <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">xend=</span>xend, <span class="at">yend=</span>yend)) <span class="sc">+</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="fu">aes</span>(<span class="at">color =</span> focal)) <span class="sc">+</span> </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>() <span class="sc">+</span> </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">'none'</span>, <span class="at">color =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#56B4E9"</span>,<span class="st">"#CC79A7"</span>)) <span class="sc">+</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand=</span><span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>))) <span class="sc">+</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#change default expansion on y-axis min &amp; max</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"DAG1"</span>) <span class="sc">+</span> </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>ouchDAG1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="modmadness-pt2-wd_files/figure-html/DAG1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 1. Simple DAG representing causal effect of window curtains on stubbed toes (ouch!)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="is-your-mechanism-a-mediator-a-moderator-or-both" class="level3">
<h3 class="anchored" data-anchor-id="is-your-mechanism-a-mediator-a-moderator-or-both">Is your mechanism a mediator, a moderator, or both?</h3>
<p>Now, let’s step back and revisit our causal assumptions. Do we <em>really</em> think the closed curtains directly caused us to stub our toes? When interrogating a causal claim, it is usually a good idea to ask “how” and “why” questions, as doing so might illuminate mechanisms that can help us better identify, predict, and explain causal relationships. For instance, <em>why</em> do we think the closed curtains caused us to stub our toe? <em>How</em> might the closed curtains have caused such an outcome to occur?</p>
<p>In this case, you probably do not think that the closed window curtains <em>directly</em> caused toe stubbing. Rather, you likely expect that closed curtains <em>indirectly</em> caused this painful outcome by blocking light from entering the room through the window. In contrast, had the window curtains been open, then there might have been more ambient light in the room and, with sufficient light, you might have been better able to see and to avoid colliding with hazardous objects.</p>
<p>Let’s recast these more precise mechanistic beliefs as potential outcomes and communicate them graphically with a new DAG.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="counterfac4.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Specifying mechanisms can help us identify, predict, and explain causal relationships.</figcaption>
</figure>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ouchDAG2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  Ouch <span class="sc">~</span> Light ,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  Light <span class="sc">~</span> Curtains, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Curtains"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Ouch"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords=</span><span class="fu">list</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="fu">c</span>(<span class="at">Curtains=</span><span class="dv">0</span>, <span class="at">Light=</span><span class="dv">1</span>, <span class="at">Ouch=</span><span class="dv">2</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(<span class="at">Curtains =</span><span class="dv">1</span>, <span class="at">Light=</span><span class="dv">1</span>, <span class="at">Ouch=</span><span class="dv">1</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">tidy_dagitty</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">focal =</span> <span class="fu">ifelse</span>(name <span class="sc">!=</span> <span class="st">"Curtains"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#CC79A7"</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>ouchDAG2 <span class="ot">&lt;-</span> <span class="fu">shorten_dag_arrows</span>(ouchDAG2, <span class="fl">0.08</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>ouchDAG2 <span class="ot">&lt;-</span> ouchDAG2 <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">xend=</span>xend, <span class="at">yend=</span>yend)) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="fu">aes</span>(<span class="at">color =</span> focal)) <span class="sc">+</span> </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>() <span class="sc">+</span> </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">'none'</span>, <span class="at">color =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#56B4E9"</span>,<span class="st">"#CC79A7"</span>)) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand=</span><span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>))) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#change default expansion on y-axis min &amp; max</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"DAG2"</span>) <span class="sc">+</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>ouchDAG2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="modmadness-pt2-wd_files/figure-html/DAG2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 2. DAG of indirect causal effect of window curtains through light on stubbed toes</figcaption>
</figure>
</div>
</div>
</div>
<p>After examining this DAG, many of you might immediately assume it that it displays a classic indirect causal effect or mediating relationship.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> However, it is worth taking a moment to ponder whether you think light really is a mediator, or instead whether it is a moderator, or perhaps both? For example, consider that opening the curtains might reduce the chances of stubbing your toes when it is light outside and, hence, when doing so lets sufficient light in the room for you to see obstacles in your path. In contrast, when it is not light outside, opening the curtains might not let sufficient light in and, in those situations, opening the curtains (i.e., <em>doing</em> X=0) might not reduce (i.e., cause) the probability of stubbing toes.</p>
<p>Put differently, we might posit a heterogeneous causal effect of opening the curtains on the probability of toe stubbing, where the causal effect is strongest when accompanied by sufficient light but weakest or nonexistent when not accompanied by sufficient light.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>If you are a social scientist, you might also be accustomed to seeing an intersecting arrow in a causal diagram to depict this type of conditional effect or moderating relationship, like below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ouchDAG2b <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  Ouch <span class="sc">~</span> Curtains ,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  holder <span class="sc">~</span> Light, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Curtains"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Ouch"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords=</span><span class="fu">list</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="fu">c</span>(<span class="at">Curtains=</span><span class="dv">0</span>, <span class="at">Light=</span><span class="dv">1</span>, <span class="at">holder=</span><span class="dv">1</span>, <span class="at">Ouch=</span><span class="dv">2</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(<span class="at">Curtains =</span><span class="dv">1</span>, <span class="at">Light=</span><span class="dv">0</span>, <span class="at">holder=</span><span class="dv">1</span>, <span class="at">Ouch=</span><span class="dv">1</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">tidy_dagitty</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">focal =</span> <span class="fu">ifelse</span>(name <span class="sc">!=</span> <span class="st">"Window"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#CC79A7"</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>ouchDAG2b <span class="ot">&lt;-</span> <span class="fu">shorten_dag_arrows</span>(ouchDAG2b, <span class="fl">0.08</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#create factor variable to isolate edge of interest, permits specifying edge color</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>ouchDAG2b <span class="ot">&lt;-</span> ouchDAG2b <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">myedge1 =</span> <span class="fu">if_else</span>(ouchDAG2b<span class="sc">$</span>data<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Light"</span> <span class="sc">&amp;</span> ouchDAG2b<span class="sc">$</span>data<span class="sc">$</span>to <span class="sc">==</span> <span class="st">"holder"</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"yes"</span>, <span class="st">"no"</span>), </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">modlinetype =</span> <span class="fu">ifelse</span>(myedge1 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#plot dag</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>fig3 <span class="ot">&lt;-</span> ouchDAG2b <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">xend=</span>xend, <span class="at">yend=</span>yend)) <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="fu">aes</span>(<span class="at">x =</span> xstart, <span class="at">y =</span> ystart, <span class="at">edge_color=</span>myedge1, </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">edge_linetype =</span> modlinetype), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">data =</span> <span class="cf">function</span>(x) <span class="fu">filter</span>(x, name <span class="sc">!=</span> <span class="st">"holder"</span>), </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">"#56B4E9"</span>) <span class="sc">+</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>() <span class="sc">+</span> </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand=</span><span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>))) <span class="sc">+</span> <span class="co">#change default expansion on y-axis min &amp; max</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"darkgrey"</span>, <span class="st">"maroon"</span>)) <span class="sc">+</span> <span class="co">#change second color to highlight focal myedge1 </span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggtitle("DAG w/mediation &amp; interaction") + </span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Classic Moderation Diagram"</span>) <span class="sc">+</span> </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>fig3 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="modmadness-pt2-wd_files/figure-html/Moderation-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 3. Causal graph of light moderating the effect of window curtains on stubbed toes</figcaption>
</figure>
</div>
</div>
</div>
<p>So, is light a mediator, or a moderator, or is it both? Well, it turns out that mediation and moderation are <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4220271/">not always as distinguishable</a> as one might think.</p>
<p>In fact, this potential overlap is communicated by a proper DAG of mediating and moderating relationships. As we noted <a href="https://reluctantcriminologists.com/blog-posts/%5B6%5D/modmadness-pt1#two-papers-walk-into-a-bar">in Part 1</a>, a traditional DAG does not use intersecting arrows to depict moderation. Rather, arrows indicate information flow, while heterogeneous (moderation) effects are captured in the functional forms of the mathematical equations used to model causal relationships. Likewise, below is a DAG that illustrates the possibility of (heterogeneous) direct and indirect effects of closed curtains on stubbing toes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ouchDAG3 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  Ouch <span class="sc">~</span> Curtains <span class="sc">+</span> Light ,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  Light <span class="sc">~</span> Curtains, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Curtains"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Ouch"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords=</span><span class="fu">list</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="fu">c</span>(<span class="at">Curtains=</span><span class="dv">0</span>, <span class="at">Light=</span><span class="dv">1</span>, <span class="at">Ouch=</span><span class="dv">2</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(<span class="at">Curtains =</span><span class="dv">0</span>, <span class="at">Light=</span><span class="dv">1</span>, <span class="at">Ouch=</span><span class="dv">0</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">tidy_dagitty</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">focal =</span> <span class="fu">ifelse</span>(name <span class="sc">!=</span> <span class="st">"Curtains"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#CC79A7"</span>))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>ouchDAG3 <span class="ot">&lt;-</span> <span class="fu">shorten_dag_arrows</span>(ouchDAG3, <span class="fl">0.08</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ouchDAG3 <span class="ot">&lt;-</span> ouchDAG3 <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">xend=</span>xend, <span class="at">yend=</span>yend)) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="fu">aes</span>(<span class="at">color =</span> focal)) <span class="sc">+</span> </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>() <span class="sc">+</span> </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">'none'</span>, <span class="at">color =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#56B4E9"</span>,<span class="st">"#CC79A7"</span>)) <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand=</span><span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>))) <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#change default expansion on y-axis min &amp; max</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"DAG3"</span>) <span class="sc">+</span> </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>ouchDAG3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="modmadness-pt2-wd_files/figure-html/DAG3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 4. DAG of direct and indirect causal effects of window curtains through light on stubbed toes</figcaption>
</figure>
</div>
</div>
</div>
<p>An important takeaway message is that when we are examining causal systems that we think might involve a mediating mechanism, it is important to formally assess whether there is evidence of a non-negligible <strong>exposure-mediator interaction</strong>. An exposure-mediator interaction is a situation where the effect of the focal cause or exposure (opening or closing the curtains) on an outcome (toe stubbing) varies across the range of values of the posited mediating mechanism (ambient light levels in the room). Often, when testing mediation hypotheses, assessing this possibility will entail the inclusion of a multiplicative interaction term representing a potential exposure-mediator interaction (X*M) into your model. If the multiplicative interaction coefficient departs from zero, then you likely need to account for the joint possibility of mediation and moderation, or of indirect and interaction effects, in your modeling approach. In this situation, you can use the “causal mediation” or potential outcomes decomposition approach to sort them out. (Note: Do NOT rely on statistical significance of the interaction coefficient to make this determination as those tests are notoriously underpowered; also, as <a href="https://reluctantcriminologists.com/blog-posts/%5B6%5D/modmadness-pt1#example-1">I discussed in the first post in this series</a>, such inferences are particularly unreliable in nonlinear models.)</p>
</section>
<section id="four-way-decomposition-with-toy-example" class="level3">
<h3 class="anchored" data-anchor-id="four-way-decomposition-with-toy-example">Four-way decomposition with toy example</h3>
<p>The first thing to note about causal mediation effect decomposition is that it generates population-average inferences about counterfactual conditions. Recall, we cannot observe counterfactual causality among individual units because we can only observe one of two (or more) possible conditions for any individual unit. In our example, either the curtains were closed or open, and either we did or did not stub our toe. If the curtains were closed and we stubbed our toe, then we cannot observe the counterfactual condition in which the curtains instead would have been open to see what might have happened to our toes. However, we <em>can</em> make causal inferences about potential outcomes across counterfactual conditions with sufficient data from populations, a careful research design, and a proper causal (theoretical) model. In our example, that would require many observations of mechanism states (ambient light levels in the room) and outcome occurrences (stubbed toes) in the room under both exposure and non-exposure conditions (when the curtains were open and when curtains were closed).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="counterfac5.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Given some key assumptions, we can estimate counterfactual causal effects as population-average differences in potential outcomes.</figcaption>
</figure>
</div>
<p>I will work through an example using simulated crime-relevant data later. First, though, I hope to build upon your intuitions about how this decomposition procedure works using some toy data based on our toe stubbing example. The goal of this example is to introduce you to key terminology and the conceptual basis for potential outcomes effect decomposition before getting into a more realistic applied example in which we will use software to perform the decomposition for us.</p>
<p>Note that this first toy example is intended as a simple application of <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4220271/#S2title">VanderWeele’s initial 4-way effect decomposition example</a> in which exposure and mediator values are set at specific counterfactual values (setting M to 0 or 1). Later, I will briefly introduce more <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4220271/#S1title">complex counterfactual logic</a> (e.g., setting M at its expected value when X=0 or X=1) required for interpreting “natural” direct and indirect effects found in <code>CMAverse</code> output. For more, and better, resources on the topic, I recommend reading VanderWeele’s 2014 paper itself. This paper and other resources, including tutorials and a short video course on causal mediation, are available <a href="https://www.hsph.harvard.edu/tyler-vanderweele/tools-and-tutorials/">on his website</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ouchdat <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="sc">~</span>CurtainClosed, <span class="sc">~</span>AmpleLight, <span class="sc">~</span>StubToe,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>ouchdat <span class="sc">%&gt;%</span> <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="xjpzwuksml" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xjpzwuksml table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xjpzwuksml thead, #xjpzwuksml tbody, #xjpzwuksml tfoot, #xjpzwuksml tr, #xjpzwuksml td, #xjpzwuksml th {
  border-style: none;
}

#xjpzwuksml p {
  margin: 0;
  padding: 0;
}

#xjpzwuksml .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xjpzwuksml .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xjpzwuksml .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xjpzwuksml .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xjpzwuksml .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xjpzwuksml .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xjpzwuksml .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xjpzwuksml .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xjpzwuksml .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xjpzwuksml .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xjpzwuksml .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xjpzwuksml .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xjpzwuksml .gt_spanner_row {
  border-bottom-style: hidden;
}

#xjpzwuksml .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xjpzwuksml .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xjpzwuksml .gt_from_md > :first-child {
  margin-top: 0;
}

#xjpzwuksml .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xjpzwuksml .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xjpzwuksml .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xjpzwuksml .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xjpzwuksml .gt_row_group_first td {
  border-top-width: 2px;
}

#xjpzwuksml .gt_row_group_first th {
  border-top-width: 2px;
}

#xjpzwuksml .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xjpzwuksml .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xjpzwuksml .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xjpzwuksml .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xjpzwuksml .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xjpzwuksml .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xjpzwuksml .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xjpzwuksml .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xjpzwuksml .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xjpzwuksml .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xjpzwuksml .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xjpzwuksml .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xjpzwuksml .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xjpzwuksml .gt_left {
  text-align: left;
}

#xjpzwuksml .gt_center {
  text-align: center;
}

#xjpzwuksml .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xjpzwuksml .gt_font_normal {
  font-weight: normal;
}

#xjpzwuksml .gt_font_bold {
  font-weight: bold;
}

#xjpzwuksml .gt_font_italic {
  font-style: italic;
}

#xjpzwuksml .gt_super {
  font-size: 65%;
}

#xjpzwuksml .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xjpzwuksml .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xjpzwuksml .gt_indent_1 {
  text-indent: 5px;
}

#xjpzwuksml .gt_indent_2 {
  text-indent: 10px;
}

#xjpzwuksml .gt_indent_3 {
  text-indent: 15px;
}

#xjpzwuksml .gt_indent_4 {
  text-indent: 20px;
}

#xjpzwuksml .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="CurtainClosed">CurtainClosed</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="AmpleLight">AmpleLight</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="StubToe">StubToe</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">1</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">1</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">1</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">1</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">1</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">1</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">1</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">1</td></tr>
    <tr><td headers="CurtainClosed" class="gt_row gt_right">0</td>
<td headers="AmpleLight" class="gt_row gt_right">0</td>
<td headers="StubToe" class="gt_row gt_right">0</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>These data represent n = 21 curtains, light, and toe stubbing observations. In approximately half of the cases, the curtains were closed (<em>CurtainClosed</em> = 1; n = 11); in the other cases, the curtains were open (<em>CurtainClosed</em> = 0; n = 10). The overall probability of stubbing toes, or P(Y), is 0.33 (<em>StubToe</em> = 1; n = 7/21). We will use these hypothetical “observed” probabilities to represent (counterfactual) expectations.</p>
<p>Y0 and Y1<br>
The probability of stubbing toes varies across exposure conditions. The probability of stubbing toes given the curtains were open, denoted by P(Y|do[X=0]) or abbreviated to Y0, is 0.2. That is, we stubbed our toes in 2 out of 10 cases in which curtains were open. In contrast, we stubbed our toes in 5 out of 11 cases in which curtains were closed, which means that P(Y|do[X=1]), or Y1, is equal to 0.45.</p>
<section id="te" class="level4">
<h4 class="anchored" data-anchor-id="te">TE</h4>
<p>In this example, we can calculate the <em>total effect</em> (TE) simply as the difference between the outcome probabilities across exposed and unexposed conditions. The estimated total effect of closing curtains on toe stubbing is Y1 - Y0, or 0.455 - 0.2, which equals 0.255. Put differently, opening curtains reduces the predicted probability of toe stubbing by about 26 percentage points (from ~45.5% to 20%).</p>
<p>M0 and M1<br>
What about our mechanism? The probability of experiencing sufficient ambient light in the room to be able to see obstacles is P(M) = 0.43, since 9 out of 21 cases had a <em>Light</em> value = 1. Like stubbing our toes, the probability of experiencing sufficient light also varied across exposure conditions. Specifically, the probability of sufficient light given the curtains were open, denoted by P(M|do[X=0]) or abbreviated to M0, is 0.80 (i.e., 8/10). In contrast, there was sufficient light in the room in only 1 out of 11 cases in which the curtains were closed, which means that P(M|do[X=1]) or M1 = 0.09.</p>
<p>Now, let’s consider jointly how the probability of stubbing our toes changes given different combinations of exposure and mediator conditions, or given that we open or close curtains and simultaneously observe the presence or absence of sufficient ambient light in the room.</p>
<p>Y00<br>
Let’s start with the probability of stubbing toes given open curtains and the absence of sufficient light, which we will denote as P(Y|do[X=0],do[M=0]) and abbreviate to Y00. Given some assumptions, this quantity represents the expected probability of stubbing our toes if we <em>do</em> X=0 (i.e., if we open the curtains) and if we were able to set the mechanism to its expected value when X=0. Here, we are “0” (i.e., we set the room to insufficient light, or <em>Light</em> = 0, with the curtains open). There were 2 observed cases in which X=0 and M=0. Perhaps these cases represented especially dark nights during which the open window curtains were not effective in increasing the amount of ambient light in the room. In half of these cases (1/2), we stubbed our toes, meaning <strong>Y00 = 0.5</strong>.</p>
<p>Y10<br>
Now, imagine we <em>do</em> X=1 instead (i.e., we close the curtains) and we continue hold the mechanism constant at the value of “0” (i.e., we set the room to insufficient light, or <em>Light</em> = 0, with the curtains closed). There are ten observed cases in which the curtains were closed and there was insufficient ambient light in the room. We stubbed our toes in five of these ten cases, meaning P(Y|do[X=1],do[M=0]) or <strong>Y10 = 0.5</strong>.</p>
</section>
<section id="cde" class="level4">
<h4 class="anchored" data-anchor-id="cde">CDE</h4>
<p>With the quantities above, we now have enough information to calculate the <em>controlled direct effect</em>, or CDE, of X on Y. Conceptually, the CDE of an exposure is the expected effect that an exposure would have on the outcome if the mechanism (M) were fixed at a specific value (m). Here is the potential outcomes equation for the CDE:</p>
<p>CDE = Y1m - Y0m, where we set M to a specific value “m”</p>
<p>Commonly, we might wish to estimate the controlled direct effect when the mediator is equal to zero. In this case, the CDE of an exposure is the expected effect that an exposure would have on the outcome if the mechanism were removed or fixed at M=0. Here, when we set M to m=0, the CDE is equivalent to the difference between Y10 and Y00, or the estimated effect on Y of <em>doing</em> X in the absence of the mechanism:</p>
<p>CDE(M=0) = Y10 - Y00<br>
= 0.5 - 0.5<br>
= 0.0</p>
<p>In essence, this value of 0.0 indicates that <em>doing</em> X = 1 (i.e., closing the curtains) instead of doing X = 0 is expected to have no effect on the probability of toe stubbing once we remove from the equation the effect that opening curtains has on the mechanism (ie., letting sufficient ambient light into the room). Put differently, closing the window curtains is not expected to have a direct effect on stubbing toes above and beyond any indirect effects it has on the ambient light levels in the room.</p>
<p>Think of it this way: You are in a dark room with curtains closed (do[X=1],do[M=0]) and, after opening the curtains, the room remained just as dark as it was before (do[X=0],do[M=0]). A CDE = 0 indicates that the probability of stubbing your toes would remain unchanged in that situation, where opening or closing the curtains does not add any ambient light into the dark room (Y10 - Y00 = 0). Either way, it is dark, and you are predicted to have a coinflip’s chance (Y10 = Y00 = .50) of stubbing your toes.</p>
<p>Y01<br>
In addition to Y10 and Y00, there are additional quantities we can estimate that will help us further decompose the total effect into other meaningful components like the CDE. For instance, what if we were to open the curtains (do[X=0]) while also holding constant a sufficient amount of ambient light in the room (do[M=1])? In our toy data, there were eight observations in which the windows were open and we experienced sufficient ambient light in the room that allowed us to see. We stubbed our toe in only one of these eight cases (1/8), so P(Y|do[X=0],do[M=1]) or <strong>Y01 = 0.125</strong>.</p>
<p>Y11<br>
Now, imagine instead we close the curtains (do[X=1]) and continue holding a sufficient amount of ambient light in the room constant (do[M=1]). There is only one observation in these toy data with X=1 and M=1. Perhaps a hall light was on, or perhaps we used our cell phone backlight to provide ambient light when the curtains were closed. In any case, we did not stub our toe in this one instance (0/1), so P(Y|do[X=1],do[M=1]) or <strong>Y11 = 0.0</strong>.</p>
</section>
<section id="te-cde-intref-intmed-pie" class="level4">
<h4 class="anchored" data-anchor-id="te-cde-intref-intmed-pie">TE = CDE + INTref + INTmed + PIE</h4>
<p>With the various quantities calculated above (e.g., M0; M1; Y00; Y10; Y01; Y11), now we have enough information to decompose the total effect of X on Y into four different components. Specifically, the total effect, or TE, is a composite value representing the sum of the controlled direct effect (CDE); reference interaction (INTref); mediated interaction (INTmed); and the pure indirect effect (PIE). I already covered the CDE above. Below, I will describe the remaining three components: INTref, INTmed, and PIE.</p>
</section>
<section id="intref" class="level4">
<h4 class="anchored" data-anchor-id="intref">INTref</h4>
<p>When we observe a nonzero total effect of an exposure on an outcome, a common thing to do is to test whether the exposure operates indirectly through a posited mediating mechanism(s). However, an observed total effect might wholly (or partly) reflect the operation of an additive interaction between the exposure and a mechanism <em>rather than</em> (or in addition to) a mediation process as is often assumed.</p>
<p>Yes, you read that right. An observed total effect of an exposure on an outcome might (only) reflect the presence of an interaction effect, and failure to account for this when testing indirect effect hypotheses using traditional mediation tests could result in erroneously attributing moderation to mediation, or vice versa. Moderator madness indeed! If you cannot recall learning about this in your graduate stats courses, then you are not alone.</p>
<p>At this point, you can probably guess that we account for this possibility by decomposing the total effect into its various possible constituent parts. As implied here, one of the components that may comprise a total effect is the <em>reference interaction</em> (INTref), which is an additive interaction that operates only if mediator is present in the absence of the exposure. As <a href="https://www.hsph.harvard.edu/wp-content/uploads/sites/603/2018/04/MedInt_Ep.pdf">VanderWeele explains (p.750)</a>, the reference interaction component is nonzero when “the effect on the outcome of setting both the exposure and the mediator to present differs from the sum of the effect of having only the exposure present and the effect of having only the mediator present.”</p>
<p>Though that might sound confusing, this is essentially a classic interaction effect. Do you find yourself preferring our probability notation yet? Either way, let’s use it to calculate INTref.</p>
<p>The INTref component is nonzero when [P(Y|do[X=1],do[M=1]) - P(Y|do[X=0],do[M=0])] is not equal to [(P(Y|do[X=1]) - P(Y|do[X=0])] + [(P(Y|do[M=1]) - P(Y|do[M=0])]. Let’s check this with our toy data, using our abbreviated notation for quantities that we have already calculated:</p>
<p>Y11 - Y00<br>
= 0.0 - 0.5<br>
= -0.5</p>
<p>[Y1 - Y0] + [(P(Y|do[M=1]) - P(Y|do[M=0])]<br>
= [0.45 - 0.2] + [.11 - 0.5]<br>
= -0.25 + -0.39<br>
= -0.64</p>
<p>Since -0.5 is not equal to -0.64, we would expect a nonzero INTref estimate.</p>
<p>We can use the quantities calculated earlier to estimate the reference interaction using the equations provided in <a href="https://www.hsph.harvard.edu/wp-content/uploads/sites/603/2018/04/MedInt_Ep.pdf">VanderWeele’s Table 1 on p.751</a>:</p>
<p>INTref = (Y11 - Y10 - Y01 + Y00)(M0)<br>
= (0.0 - 0.5 - 0.125 + 0.5)(0.8)<br>
= (-.125)(0.8)<br>
= -0.1</p>
<p>Here, our toy data show a small reference interaction. What does this mean and where did it come from? Well, first remember that a reference interaction is an additive interaction that operates only if mediator is present in the absence of the exposure. Likewise, we observed the mechanism (sufficient ambient light) when the curtains were open and when they were closed, so a nonzero reference interaction estimate is possible. The logic here, which mirrors that of a classic interaction, is that we must be able to assess the effect of <em>doing</em> X=1 (versus X=0) both in the absence and in the presence of the mechanism. Then, if the estimated effect of doing X differs across those conditions (or across levels of the mechanism), we would have a nonzero exposure-mediator “reference interaction.”</p>
<p>Now, recall that we did not stub our toes in that one time we observed closed curtains and the mechanism present (Y11 = 0/1 = 0.0). However, we did stub our toe in one of the eight instances with open curtains and the mechanism present (Y01 = 1/8 = 0.125). Meanwhile, the probability of stubbing our toes was equal across exposure conditions in the absence of the mediator (Y10 = 5/10 = 0.5; Y00 = 1/2 = 0.5).</p>
<p>From these comparisons, it appears that doing X=1 instead of X=0 (closing curtains) slightly <em>reduced</em> the probability of toe stubbing with the mechanism present (Y11 - Y01 = 0.0 - 0.125 = -.125), whereas doing X=1 instead of X=0 had no effect on the probability of toe stubbing with the mechanism absent (Y10 - Y00 = 0.5 - 0.5 = 0). In the equation above, we essentially used these same comparisons and then weighted the resulting difference-in-differences value by the expectation of observing the mediator in the absence of exposure (i.e., M0 = probability of observing M=1 given we do[X=0]).<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>Strong caveat: If these were real data, I would strongly recommend against making any inferences from this INTref estimate given it was generated using a very small sample (e.g., only n=1 observation for one of the cells). Unfortunately, such <a href="https://journals.sagepub.com/doi/full/10.1177/0049124119826158">noisy and unreliable inferences</a> are all too common in criminology. But, that is an entry for another day.</p>
<p>One final point about the INTref component: As <a href="https://www.hsph.harvard.edu/wp-content/uploads/sites/603/2018/04/MedInt_Ep.pdf">VanderWeele explains (p.755)</a>, the INTref “requires the mediator to operate, but the effect does not come about by the exposure changing the mediator — it simply requires that the mediator is present even when the exposure is absent; the effect is ‘unmediated,’ in the sense that it does not operate by the exposure changing the mediator, but it requires the presence of the mediator nonetheless.” In contrast, the remaining two components (PIE and INTmed) both involve mediation such that <em>doing</em> X (i.e., the exposure) affects the outcome at least partly by changing the mediator. Now, let’s move to the next component.</p>
</section>
<section id="pie" class="level4">
<h4 class="anchored" data-anchor-id="pie">PIE</h4>
<p>As noted above, when we observe a total effect of an exposure on an outcome, that total effect might also reflect an indirect effect of the exposure operating through a specific mediating mechanism(s). In this four-way decomposition, the “pure indirect effect” (PIE) component is the analogue of this classic indirect effect. Formally, the PIE component represents the effect of the mediator in the absence of the exposure, and it is non-zero only if: (1) the exposure itself affects mediator and (2) the mediator affects the outcome when the exposure is absent.</p>
<p>Here, closing curtains decreases light in the room, and light reduces the chances of stubbing toes when the curtains are open. Using the equations in <a href="https://www.hsph.harvard.edu/wp-content/uploads/sites/603/2018/04/MedInt_Ep.pdf">VanderWeele’s Table 1</a>, we can estimate the PIE component using the quantities calculated earlier by estimating the effect of <em>doing</em> M in the absence of X (Y01 - Y00) and then weighting this contrast by the effect of <em>doing</em> X on the mediator (M1-M0):</p>
<p>PIE = (Y01 - Y00)(M1 - M0)<br>
= (0.125 - 0.5)(0.09 - 0.8)<br>
= (-0.375)(-0.71)<br>
= 0.266</p>
<p>Recall, the total effect of closing the curtains on toe stubbing was 0.255. Closing curtains primarily increases our chances of stubbed toes indirectly by blocking light out of the room. In this case, the indirect effect estimate is quite close to the total effect estimate (0.266 versus 0.255). However, it does not always work out this way. In fact, as we will see, the only reason it worked out this way in our toy example is because the other two nonzero components, INTref and INTmed, were of approximately equal magnitude with opposite signs, so they cancel each other out when summing for the total effect.</p>
<p>This is an important point. If we had relied strictly on the total effect, or on traditional mediation test procedures, to make inferences about the exposure’s effect on the outcome via the primary mediating mechanism, then we would have been close to accurately estimating the indirect effect. However, we would have done so only by luck or accident, and we would have missed completely the other two nonzero interaction components. Speaking of those other two interaction components, we already discussed INTref; now, let’s move onto INTmed, our fourth component.</p>
</section>
<section id="intmed" class="level4">
<h4 class="anchored" data-anchor-id="intmed">INTmed</h4>
<p>So far, we have discussed controlled direct effects, reference interaction effects, and pure indirect effects. Each of these is analogous (in certain situations) to well-known direct effects, interaction effects (moderation), and indirect effects (mediation), though their empirical overlap as distinct components of a total effect may be less widely appreciated or understood.</p>
<p>This is good time to introduce the most important use cases for decomposition: When there is no exposure-mediator interaction (and strong causal assumptions hold), then traditional approaches to detecting interaction effects or testing indirect effects are often reliable and decomposition procedures may be unnecessary. However, <strong>when there is a nonzero exposure-mediator interaction, then traditional approaches become problematic, decomposition is essential, and the constituent components comprising a total effect become more complex - and potentially more numerous</strong>. For instance, in such situations, we may find a fourth nonzero component also contributes to the total effect - the “mediated interaction” or <em>INTmed</em>.</p>
<p>The “mediated interaction” or INTmed component represents an additive interaction that operates only if the exposure has an effect on the mechanism. As <a href="https://www.hsph.harvard.edu/wp-content/uploads/sites/603/2018/04/MedInt_Ep.pdf">VanderWeele explains (p.750)</a>, when the INTmed component is nonzero, this means that “the exposure causes the mediator, and the presence of the mediator is itself necessary for the exposure to have an effect on the outcome.”</p>
<p>In our toy example, the probability of stubbing our toes varies across values of X (i.e., whether curtains are open or closed); that is, P(Y|do[X=x],do[M=1]) varies across do[X=0] and do[X=1]. Given the presence of the mechanism (sufficient ambient light), the probability of stubbing toes is higher when the exposure is “absent” (X=0, or curtains open) than it is when the exposure is present (X=1, or curtains closed). We can check this with our data:</p>
<p>Curtains open: P(Y|do[X=0],do[M=1]) = Y01 = 1/8 = 0.125<br>
Curtains closed: P(Y|do[X=1],do[M=1]) = Y11 = 0/1 = 0.0</p>
<p>We can also use the quantities estimated earlier to calculate the INTmed component. Like the INTref component, we are essentially generating a weighted difference-in-difference contrast. Like the PIE component, we are weighting that contrast by the effect of <em>doing</em> X on the mediator (M1 - M0):</p>
<p>INTmed = (Y11 - Y10 - Y01 + Y00)(M1 - M0)<br>
= (0.0 - 0.5 - 0.125 + 0.5)(0.09 - 0.8)<br>
= (-0.125)(-0.71)<br>
= 0.089</p>
<p>Recall, when the mechanism was present in this toy example (i.e., <em>Light</em>=1), toe stubbing was less likely when the curtains were closed (Y11 = 0.0) than when they were open (Y01 = 0.125). In other words, closing the curtains (do[X=1]) reduced the probability of toe stubbing in the presence of the mechanism. However, this effect was only observed in the presence of the mechanism; when <em>Light</em>=0, the probability of toe stubbing was the same whether the curtains were open (Y00 = 0.5) or closed (Y10 = 0.5). Moreover, closing the curtain reduced the probability of observing the mechanism (M1 - M0 = 0.09 - 0.80 = -0.71). So, the exposure causes this conditional effect, meaning it is a mediated interaction (INTmed).</p>
<p>Put differently, since <em>opening</em> the curtains increases light in the room, and opening the curtains appears to increase toe stubbing when light is present, then the exposure actually increases risks of toe stubbing by increasing the conditions (light) under which it amplifies the risks of the outcome occurring. Again, this is a mediated interaction.</p>
<p>Another caveat: I strongly caution against such real world inferences when data are so sparse; like our INTref, this mediated interaction is based on a comparison generated from n=1 observation in one of the cells! If we had more (and real) data, I highly doubt we would observe a negative effect of closing curtains on toe stubbing in the presence of the mechanism. Still, despite the implausibility of this toy example, I hope it helps you better understand the components that comprise a total effect.</p>
</section>
<section id="revisiting-te" class="level4">
<h4 class="anchored" data-anchor-id="revisiting-te">Revisiting TE</h4>
<p>Before moving onto a simulated example, I want to revisit the <em>total effect</em> (TE) that we just decomposed into four component parts. Recall earlier how we calculated the total effect of X on Y as the difference between the outcome probabilities across exposed and unexposed conditions (Y1 - Y0)?</p>
<p>TE = Y1 - Y0<br>
= 0.455 - .20<br>
= 0.255</p>
<p>Well, after decomposing these four constituent components of the total effect, we can also calculate the total effect by summing these four components. This is a good way to check that our calculations were correct!</p>
<p>TE = CDE + INTref + INTmed + PIE<br>
= 0 + (-0.1) + 0.089 + 0.266<br>
= 0.255</p>
<p>It worked! Whew.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="not-worried.gif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">I wasn’t worried. Were you?</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="section-b.-simulated-effect-decomposition-with-cmaverse" class="level2">
<h2 class="anchored" data-anchor-id="section-b.-simulated-effect-decomposition-with-cmaverse">Section B. Simulated Effect Decomposition with CMAverse</h2>
<p>At this point, I am hoping the toy example above strengthened your intuitions for the 4-way decomposition process. I hope you feel ready to move onto a more complicated and realistic use case with simulated data and the <a href="https://bs1125.github.io/CMAverse/"><code>CMAverse</code> R package</a>. Though it took a long time to arrive here, as I explained in our <a href="https://reluctantcriminologists.com/blog-posts/%5B6%5D/modmadness-pt1#example-2">Moderator Madness, Part 1 post</a>, this was the primary goal that initially motivated this blog series:</p>
<blockquote class="blockquote">
<p>The central aim of [“Moderator Madness, Part 2”] will be to illustrate how exposure-mediator interactions entangle mediation and moderation processes in a way that requires decomposition of the effect. Effect decomposition is accomplished with a <a href="https://www.hsph.harvard.edu/tyler-vanderweele/tools-and-tutorials/">causal mediation approach</a> that involves clever estimation of potential outcomes and transparent acknowledgement of strong causal assumptions underlying those estimates…”</p>
</blockquote>
<blockquote class="blockquote">
<p>“…[I]n Part 2 of the blog series, I will pick up here using the same simulated data from this example to illustrate how the addition of an exposure-mediator interaction entangles indirect and interaction effects in a way that requires decomposition of these effects. I will also illustrate how one can accomplish effect decomposition with a causal mediation approach that involves clever estimation of potential outcomes and transparent acknowledgement of strong causal assumptions underlying those estimates.”</p>
</blockquote>
<p>Without further ado, let’s get to it!</p>
<section id="simulation-and-causal-mediation-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="simulation-and-causal-mediation-assumptions">Simulation and “causal mediation” assumptions</h3>
<p>For this illustration, I will generate simulated data that are very similar to those found in <a href="https://reluctantcriminologists.com/blog-posts/%5B6%5D/modmadness-pt1#outline-of-the-post">Example 2 from our “Moderator Madness: Part 1” post</a>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> In that post, I stated:</p>
<blockquote class="blockquote">
<p>In the second example, I assume that the true data generating process underlying both imaginary papers (i.e., “paper 1” and “paper 2” in our example above) is an integrated causal model in which moral beliefs is both a mediating and moderating mechanism. That is, in the simulated data for the second example, there is a true indirect effect of <em>parental support</em> on delinquency through <em>strong moral beliefs</em> as well as a direct effect of <em>parental support</em> on <em>delinquency</em> that varies systematically across levels of (i.e., “interacts with”) <em>strong moral beliefs</em>.</p>
</blockquote>
<p>Thus, the simulated data here contain the same three focal variables. The exposure, <em>parental support</em> practices, is conceptualized as a variable measure of parental intervention(s) on youth attitudes and behaviors; it is generated here as a continuous, normally distributed, mean-centered variable. The mechanism, youths’ <em>strong moral beliefs</em>, is generated as a negatively skewed ordinal variable ranging from 0 to 5, which was created by reverse-scoring a truncated Poisson-distributed <em>weak moral beliefs</em> variable. The outcome, <em>delinquency</em>, is a positively skewed, Poisson-distributed event count variable ranging from 0 to a truncated theoretical maximum of 7. I changed some of the effect magnitudes</p>
<p>Again, the simulated data will be generated using the following hypothetical causal mediation and moderation assumptions: <em>Parental support</em> practices are a somewhat effective cause of youth’s internalization of <em>strong moral beliefs</em>, and <em>strong moral beliefs</em> effectively cause fewer delinquent behavior events (i.e., they constrain temptations, promote resistance to, or encourage selection out of delinquency). Thus, the data generating processes include causal mediation or indirect effects of an exposure through a mechanism.</p>
<p>Additionally, <em>parental support</em> directly discourages and reduces involvement in youth delinquency. However, this effect varies across levels of the mechanism. Specifically, parental support’s negative effect on youth delinquency is most pronounced among youth with weak moral beliefs (i.e., low <em>strong moral beliefs</em> index scores); these youth are most at risk of engaging in delinquency, so effective parental interventions have the greatest potential to enact behavioral change among these youth. In contrast, youth with strong moral beliefs are highly unlikely to engage in delinquency irrespective of the degree of parental support they experience; therefore, parental support is largely ineffective among youth with the highest <em>strong moral beliefs</em> index scores. This means the data generating processes include moderation or interaction effects.</p>
<p>Moreover, since parental support both operates indirectly through and interacts with youth’s strong moral beliefs, the data generating processes also involve an exposure-mediator interaction. That is, some of parental support’s conditional effect on delinqeuncy might be attributable to a <em>reference interaction</em>, or heterogeneity in the effect of parental support across levels of the mechanism (e.g., across youth with weak versus strong moral beliefs). Yet, since parental support also partly causes strong moral beliefs, then parental support is partly responsible for setting the very levels across which it conditionally affects delinquency. This means that some of parental support’s conditional effect also is likely attributable to a <em>mediated interaction</em>.</p>
<p>In causal mediation analysis using potential outcomes, the <em>mediated interaction</em> component will be variously attributed to quantities representing the direct effect of the exposure or, instead, to quantities representing the indirect effect through the mechanism; which a researcher chooses to report will depend upon one’s focal research questions and estimand of interest. I will explain this in more detail later. For now, let’s check out a modified version of <a href="https://reluctantcriminologists.com/blog-posts/%5B6%5D/fig1.png">Part 1’s basic DAG</a>, which concisely communicates the causal assumptions underlying the data generating processes for our simulation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modified from Valeri &amp; VanderWeele 2013, Fig.2 </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># causalDAG2 &lt;- dagify(</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   Y ~ A + M + C1 + C2,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   M ~ A + C1 + C2,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   A ~ C1,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   exposure = "A",</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   outcome = "Y",</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   coords=list(</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     x=c(A=1, M=1.5, Y=2, C1=1.5, C2=1.9),</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     y=c(A=1, M=2, Y=1, C1=1.4, C2=1.75)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   )) %&gt;% tidy_dagitty() </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># change to simplified version from </span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://bs1125.github.io/CMAverse/articles/quickstart.html</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>causalDAG2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> A <span class="sc">+</span> M <span class="sc">+</span> C,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  M <span class="sc">~</span> A <span class="sc">+</span> C,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">~</span> C,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"A"</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords=</span><span class="fu">list</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">1</span>, <span class="at">M=</span><span class="fl">1.5</span>, <span class="at">Y=</span><span class="dv">2</span>, <span class="at">C=</span><span class="fl">1.5</span>),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">1</span>, <span class="at">M=</span><span class="dv">2</span>, <span class="at">Y=</span><span class="dv">1</span>, <span class="at">C=</span><span class="dv">3</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">tidy_dagitty</span>()</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#shorten edges</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>causalDAG2p <span class="ot">&lt;-</span> <span class="fu">shorten_dag_arrows</span>(causalDAG2, <span class="fl">0.08</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#create factor variable to isolate edge of interest, permits specifying edge color</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>causalDAG2p <span class="ot">&lt;-</span> causalDAG2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">myedge1 =</span> <span class="fu">if_else</span>(causalDAG2p<span class="sc">$</span>data<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"C"</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># myedge1 = if_else(causalDAG2p$data$name == "C1" | causalDAG2p$data$name == "C2",</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                   "yes", "no"), </span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">modlinetype =</span> <span class="fu">ifelse</span>(myedge1 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="st">"solid"</span>, <span class="st">"solid"</span>) <span class="co">#change 2nd "solid" to "dashed" if desired</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#plot dag</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>fig4 <span class="ot">&lt;-</span> causalDAG2p <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">xend=</span>xend, <span class="at">yend=</span>yend)) <span class="sc">+</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="fu">aes</span>(<span class="at">x =</span> xstart, <span class="at">y =</span> ystart, <span class="at">edge_color=</span>myedge1, </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">edge_linetype =</span> modlinetype), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">label=</span><span class="fu">c</span>(<span class="st">"A</span><span class="sc">\n</span><span class="st">(Parental</span><span class="sc">\n</span><span class="st">Support)"</span>, <span class="st">"C</span><span class="sc">\n</span><span class="st">(Measured Confounders</span><span class="sc">\n</span><span class="st">Not Affected by Exposure)"</span>, <span class="st">"M</span><span class="sc">\n</span><span class="st">(Moral</span><span class="sc">\n</span><span class="st">Beliefs)"</span>, <span class="st">"Y</span><span class="sc">\n</span><span class="st">(Delinquency)"</span>), </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">"#56B4E9"</span>) <span class="sc">+</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>() <span class="sc">+</span> </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">'none'</span>, <span class="at">color =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand=</span><span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>))) <span class="sc">+</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">#change default expansion on y-axis min &amp; max</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggtitle("Modified Figure 2 from Valeri &amp; VanderWeele 2013") + </span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"darkgrey"</span>, <span class="st">"maroon"</span>)) <span class="sc">+</span> </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="modmadness-pt2-wd_files/figure-html/DAG4-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 4. DAG illustrating ‘no unmeasured confounding’ assumptions underlying causal mediation (modified from Fig.2 in Valeri &amp; VanderWeele 2013)</figcaption>
</figure>
</div>
</div>
</div>
<p>The major changes here to Part 1’s DAG include the addition of common “causal mediation” notations to variable names (e.g.&nbsp;exposure label “A” to “Parental Support” variable) and the addition of “measured confounders.” With the addition of confounders, I hope to remind readers that interpreting results and making causal inferences from results of “causal mediation” models - as well as from traditional mediation models - requires important (and perhaps untenable) assumptions about the lack of unmeasured sources of confouding of the X-M, M-Y, or X-Y relationships. <a href="https://pubmed.ncbi.nlm.nih.gov/23379553/">Valeri and VanderWeele (2013)</a> succinctly describe these essential assumptions:</p>
<blockquote class="blockquote">
<p>“…controlled direct effects require (i) no unmeasured treatment-outcome confounding and (ii) no unmeasured mediator-outcome confounding. Natural direct and indirect effects require these assumptions and also (iii) no unmeasured treatment-mediator confounding and (iv) no mediator-outcome confounder affected by treatment.” (p.??)</p>
</blockquote>
<blockquote class="blockquote">
<p>“It is important to note that randomizing the treatment is not enough to rule out confounding issues in mediation analysis. This is because randomization of the treatment rules out the problem of treatment-outcome and treatment-mediator confounding but does not guarantee that the assumption of no confounding of mediator-outcome relationship holds. This is because even if the treatment is randomized, the mediator generally will not be.” (p.??)</p>
</blockquote>
<p>As the simulated example is complex enough, I opted not to include any confounders of the modeled relationships; however, once one is familiar with CMAverse code, terminology, and interpretation of results, it is relatively trivial to extend the example by including and adjusting for measured confounders.</p>
</section>
<section id="terminology" class="level3">
<h3 class="anchored" data-anchor-id="terminology">Terminology</h3>
<p>Before getting to the simulation, it is probably a good idea to introduce some minor changes in terminology and basic notation that you will encounter when using CMAverse to perform effect decomposition.</p>
<section id="variables" class="level4">
<h4 class="anchored" data-anchor-id="variables">Variables</h4>
<p>First, the focal variables are labeled as follows:</p>
<p>Exposure == A (Alternatively referred to as “X” above)<br>
Mediator == M<br>
Outcome == Y<br>
Confounders == C (Ignored throughout, but <a href="https://reluctantcriminologists.com/blog-posts/%5B5%5D/colliders">choose wisely</a>)</p>
<p>Though I do not include confounders in this example, two types of outcome confounders are sometimes distinguished as C1 (exposure-outcome confounders) and C2 (mediator-outcome confounders). Note that there may also be potential confounding of the exposure-mediator relationship.</p>
</section>
<section id="controlled-versus-natural-effects" class="level4">
<h4 class="anchored" data-anchor-id="controlled-versus-natural-effects">Controlled versus Natural Effects</h4>
<p>Second, the CMAverse output will contain terms that do not exactly match the four-way effect decomposition components described above:</p>
<p>Direct Effects: You should recognize the <em>controlled direct effect</em> (CDE). However, the output may also contain estimates for a <em>pure natural direct effect</em> (PNDE) and a <em>total natural direct effect</em> (TNDE).</p>
<p>Indirect Effects: Instead of encountering a <em>pure indirect effect</em> (PIE) estimate, the output might instead contain estimates for a <em>pure natural indirect effect</em> and a <em>total natural indirect effect</em>.</p>
<p>You can find <a href="https://www.publichealth.columbia.edu/research/population-health-methods/causal-mediation">more detailed explanations elsewhere</a> for the differences between controlled and natural effects. As explained above, controlled direct effects hold the mediator constant at a specific value (M=m). For example, a controlled direct effect (CDE) might contrast expected outcomes across X=0 and X=1 while holding the mechanism constant at a specific value like M=0.</p>
<p>In contrast, understanding natural effects requires comprehending a different type of counterfactual. Remember that, in the presence of mediation, the mediator is expected to change as the exposure changes. So, setting the mediator to a constant value (e.g., M=0) may not provide a realistic or “natural” contrast. Natural effects allow the mediator to vary as it “naturally” would across exposure conditions; effects are estimated by holding the mediator constant at specific counterfactual values that the mediator would be expected to take under different exposure conditions. For example, a (pure) natural direct effect might be estimated as a contrast between the expected outcome value when X=1 and M is set to its expected value when X=0 versus the expected outcome when X=0 and M is still set to its expected value when X=0. Modifying the notation used above, you might summarize this contrast as Y(do[X=1],do[M<sub>X=0</sub>]) - Y(do[X=0],do[M<sub>X=0</sub>]).<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>Once you wrap your head around these important distinctions between natural and controlled effects, then you may find yourself beginning to comprehend other important issues related to mediation, moderation, and effect decomposition.</p>
<p>First, in a linear model without interactions (i.e., where INTref=0 and INTmed=0), the CDE estimates will not change across different values of M. Additionally, in such models, controlled and natural direct effects will converge on the same estimates.</p>
<p>Second, as you have probably figured out by now, things are not as straightforward in more complex models with nonlinear link functions or exposure-mediator interactions. Specifically, when there are nonlinearities or exposure-mediator interactions, one could conceivably estimate a different CDE estimate for every possible value of M! This makes it impossible to perform effect decomposition in the presence of an interaction using controlled effects. However, the counterfactual contrasts underlying natural direct and indirect effect estimates are uniquely defined so there is a single value even in the presence of nonlinearities and exposure-mediator interactions. This permits us to perform effect decomposition even in those situations involving more complex causal relationships.</p>
</section>
<section id="pure-versus-total-effects" class="level4">
<h4 class="anchored" data-anchor-id="pure-versus-total-effects">Pure versus Total Effects</h4>
<p>I just told you that there is only one natural direct and natural indirect effect. Yet, your CMAverse output shows more than one natural direct and indirect effect estimates! Don’t lose trust in me just yet. It is more accurate to say that there is only one “pure” natural direct effect, and there is only one “total” natural direct effect estimate…</p>
<p>As far as the differences between “pure” and “total” effects…</p>
<p>We pair a “pure” direct effect with a “total” indirect effect, and vice versa:</p>
<ul>
<li>Pure natural direct effect &amp; total natural indirect effect (PNDE &amp; TNIE)</li>
<li>Total natural direct effect &amp; pure natural direct effect (TNDE &amp; PNIE)</li>
</ul>
<p>Depends on if you want the INTmed attributed to the indirect effect or to the direct effect… “pure” is without it, whereas “total” is with it…</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="vanderweele-table4.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Table 4 from VanderWeele 2014</figcaption>
</figure>
</div>
</section>
</section>
<section id="simulate-data" class="level3">
<h3 class="anchored" data-anchor-id="simulate-data">Simulate data</h3>
<p>Unlike in Part 1, this analysis will be based on n=10,000 simulated observations to generate precise estimates of the focal components. We have more than enough going on; we do not need to deal simultaneously with issues related to noisy estimates.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|message=FALSE </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">0</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data (Sim.2)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1138</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>def2 <span class="ot">&lt;-</span> <span class="fu">defData</span>(<span class="at">varname =</span> <span class="st">"ParentSupport"</span>, <span class="at">dist =</span> <span class="st">"normal"</span>, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">formula =</span> <span class="dv">0</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>def2 <span class="ot">&lt;-</span> <span class="fu">defData</span>(def2, <span class="at">varname =</span> <span class="st">"WeakMoralBlfs"</span>, <span class="at">dist =</span> <span class="st">"poisson"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"-.3 + (-.3)*ParentSupport"</span>, <span class="at">link =</span> <span class="st">"log"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>def2 <span class="ot">&lt;-</span> <span class="fu">defData</span>(def2, <span class="at">varname =</span> <span class="st">"Delinquency"</span>, <span class="at">dist =</span> <span class="st">"poisson"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"-.7 + (-.25)*ParentSupport + .4*WeakMoralBlfs + </span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="st">    (-.15)*ParentSupport*WeakMoralBlfs"</span>, <span class="at">link =</span> <span class="st">"log"</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>simdat2 <span class="ot">&lt;-</span> <span class="fu">genData</span>(n, def2)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># simdat2 %&gt;% sjPlot::view_df()</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># simdat2 %&gt;% </span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x=WeakMoralBlfs, y=Delinquency)) +</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point()</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># cap LowMoral at 5 (0-5 item) - randomly replace oob values with values in bounds </span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>inds2 <span class="ot">&lt;-</span> simdat2<span class="sc">$</span>WeakMoralBlfs <span class="sc">&gt;</span> <span class="dv">5</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>simdat2<span class="sc">$</span>WeakMoralBlfs[inds2] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">sum</span>(inds2), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>simdat2<span class="sc">$</span>StrgMoralBlfs <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">-</span> simdat2<span class="sc">$</span>WeakMoralBlfs</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># cap Delinquency at 7 (0-7 item) - randomly replace oob values with in bounds values</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>inds2 <span class="ot">&lt;-</span> simdat2<span class="sc">$</span>Delinquency <span class="sc">&gt;</span> <span class="dv">7</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>simdat2<span class="sc">$</span>Delinquency[inds2] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">7</span>, <span class="fu">sum</span>(inds2), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># simdat2 %&gt;% sjPlot::view_df()</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># simdat2 %&gt;%</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x=WeakMoralBlfs, y=Delinquency)) +</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point()</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Even with n=10k, need to consider collapsing low values for StrgMoralBlfs and recenter to min=0</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Raise points re: rare events &amp; skewed data</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># out of n=10k, 18.1% of cases have StrgMoralBlfs &lt;=3 </span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># (nrow(subset(simdat2, StrgMoralBlfs &lt;=3))/10000)*100</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># out of n=10k, 1.02% (n=102) of cases have StrgMoralBlfs &lt;=1 </span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>      <span class="co"># (nrow(subset(simdat2, StrgMoralBlfs &lt;=1))/10000)*100</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># out of n=10k, 0.17% (n=17) of cases have StrgMoralBlfs &lt;=0 </span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># (nrow(subset(simdat2, StrgMoralBlfs &lt;=1))/10000)*100</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Collapse [0,1] values &amp; recenter StrgMoralBlfs from 0-4</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>simdat3 <span class="ot">&lt;-</span> simdat2 <span class="sc">%&gt;%</span> </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">StrgMoralBlfs =</span> <span class="fu">if_else</span>(</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>      StrgMoralBlfs <span class="sc">&lt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, StrgMoralBlfs), </span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">StrgMoralBlfs =</span> StrgMoralBlfs <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simdat3<span class="sc">$</span>StrgMoralBlfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    3.00    3.00    3.24    4.00    4.00 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(simdat3, <span class="fu">aes</span>(<span class="at">x =</span> ParentSupport, <span class="at">y =</span> StrgMoralBlfs)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Densigram</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(p, <span class="at">type =</span> <span class="st">"densigram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modmadness-pt2-wd_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note joint distribution… lack of observations at high ParentSupport and low StrgMoralBlfs. This is expected given mediation processes; high parental support causes strong moral beliefs…</p>
</section>
<section id="regression-plot" class="level3">
<h3 class="anchored" data-anchor-id="regression-plot">Regression &amp; Plot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sim.2 linear model</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Delinquency <span class="sc">~</span> ParentSupport <span class="sc">*</span> StrgMoralBlfs, <span class="at">data=</span>simdat3)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sim.2 nonlinear model</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Delinquency <span class="sc">~</span> ParentSupport <span class="sc">*</span> StrgMoralBlfs, <span class="at">data=</span>simdat3, <span class="at">family=</span><span class="st">"poisson"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># function for custom p-values</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>roundp <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">if_else</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(x), </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_character_</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(x <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="fu">format</span>(x, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">scientific =</span> <span class="cn">TRUE</span>), <span class="fu">format</span>(<span class="fu">round</span>(x, <span class="dv">3</span>), <span class="at">scientific =</span> F))</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># function for reg output w/custom p-values</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>regsum <span class="ot">&lt;-</span> <span class="cf">function</span>(mymod) {</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(mymod, <span class="at">intercept=</span><span class="cn">TRUE</span>, <span class="at">pvalue_fun =</span> roundp) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_significance_stars</span>(</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">hide_se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">hide_ci =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">hide_p =</span> <span class="cn">FALSE</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression output</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>Ex2tab1 <span class="ot">&lt;-</span> <span class="fu">regsum</span>(lm2) <span class="sc">%&gt;%</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Linear model, Sim.2"</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>Ex2tab2 <span class="ot">&lt;-</span> <span class="fu">regsum</span>(glm2) <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Poisson regression predicting delinquency event rates"</span>)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot interactions </span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot at all four values: minimum (0), (1), median (2), and maximum (3) strong moral beliefs</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#show x-axis from approx -2sd to 2sd parental support</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>plot_glm2 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(glm2, <span class="at">type =</span> <span class="st">"pred"</span>,  </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"ParentSupport"</span>, <span class="st">"StrgMoralBlfs [0,2,4]"</span>)) <span class="sc">+</span> </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">7</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">8</span>)) <span class="sc">+</span> <span class="fu">scale_colour_colorblind</span>() <span class="sc">+</span> </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_colorblind</span>() <span class="sc">+</span> </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Parental Support"</span>, </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Delinquency"</span>,</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Predicted conditional marginal effects of parent support on delinquency"</span>, </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Plotted at minimum (0), scale midpoint (2), &amp; maximum (4) strong moral beliefs</span><span class="sc">\n</span><span class="st">(Poisson regression, n=10k simulated observations)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="results-simulation-2" class="level4">
<h4 class="anchored" data-anchor-id="results-simulation-2">Results (Simulation 2)</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Nonlinear Poisson model</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Prediction Plots</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Ex2tab2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="mrdtrmifsa" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mrdtrmifsa table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mrdtrmifsa thead, #mrdtrmifsa tbody, #mrdtrmifsa tfoot, #mrdtrmifsa tr, #mrdtrmifsa td, #mrdtrmifsa th {
  border-style: none;
}

#mrdtrmifsa p {
  margin: 0;
  padding: 0;
}

#mrdtrmifsa .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mrdtrmifsa .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mrdtrmifsa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mrdtrmifsa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mrdtrmifsa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mrdtrmifsa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mrdtrmifsa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mrdtrmifsa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mrdtrmifsa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mrdtrmifsa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mrdtrmifsa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mrdtrmifsa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mrdtrmifsa .gt_spanner_row {
  border-bottom-style: hidden;
}

#mrdtrmifsa .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mrdtrmifsa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mrdtrmifsa .gt_from_md > :first-child {
  margin-top: 0;
}

#mrdtrmifsa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mrdtrmifsa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mrdtrmifsa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mrdtrmifsa .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mrdtrmifsa .gt_row_group_first td {
  border-top-width: 2px;
}

#mrdtrmifsa .gt_row_group_first th {
  border-top-width: 2px;
}

#mrdtrmifsa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mrdtrmifsa .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mrdtrmifsa .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mrdtrmifsa .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mrdtrmifsa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mrdtrmifsa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mrdtrmifsa .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mrdtrmifsa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mrdtrmifsa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mrdtrmifsa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mrdtrmifsa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mrdtrmifsa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mrdtrmifsa .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mrdtrmifsa .gt_left {
  text-align: left;
}

#mrdtrmifsa .gt_center {
  text-align: center;
}

#mrdtrmifsa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mrdtrmifsa .gt_font_normal {
  font-weight: normal;
}

#mrdtrmifsa .gt_font_bold {
  font-weight: bold;
}

#mrdtrmifsa .gt_font_italic {
  font-style: italic;
}

#mrdtrmifsa .gt_super {
  font-size: 65%;
}

#mrdtrmifsa .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mrdtrmifsa .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mrdtrmifsa .gt_indent_1 {
  text-indent: 5px;
}

#mrdtrmifsa .gt_indent_2 {
  text-indent: 10px;
}

#mrdtrmifsa .gt_indent_3 {
  text-indent: 15px;
}

#mrdtrmifsa .gt_indent_4 {
  text-indent: 20px;
}

#mrdtrmifsa .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Poisson regression predicting delinquency event rates</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>log(IRR)</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1,2</sup></span>"><strong>log(IRR)</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1,2</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>SE</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>2</sup></span>"><strong>SE</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>2</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">(Intercept)</td>
<td headers="estimate" class="gt_row gt_center">0.89***</td>
<td headers="std.error" class="gt_row gt_center">0.039</td>
<td headers="ci" class="gt_row gt_center">0.81, 0.96</td>
<td headers="p.value" class="gt_row gt_center">1.44e-114</td></tr>
    <tr><td headers="label" class="gt_row gt_left">ParentSupport</td>
<td headers="estimate" class="gt_row gt_center">-0.51***</td>
<td headers="std.error" class="gt_row gt_center">0.028</td>
<td headers="ci" class="gt_row gt_center">-0.56, -0.45</td>
<td headers="p.value" class="gt_row gt_center"> 1.87e-73</td></tr>
    <tr><td headers="label" class="gt_row gt_left">StrgMoralBlfs</td>
<td headers="estimate" class="gt_row gt_center">-0.39***</td>
<td headers="std.error" class="gt_row gt_center">0.012</td>
<td headers="ci" class="gt_row gt_center">-0.41, -0.36</td>
<td headers="p.value" class="gt_row gt_center">4.93e-216</td></tr>
    <tr><td headers="label" class="gt_row gt_left">ParentSupport * StrgMoralBlfs</td>
<td headers="estimate" class="gt_row gt_center">0.04***</td>
<td headers="std.error" class="gt_row gt_center">0.009</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.06</td>
<td headers="p.value" class="gt_row gt_center"> 9.97e-06</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="5"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> *p&lt;0.05; **p&lt;0.01; ***p&lt;0.001</td>
    </tr>
    <tr>
      <td class="gt_footnote" colspan="5"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span> IRR = Incidence Rate Ratio, SE = Standard Error, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|message=FALSE </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plot_glm2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modmadness-pt2-wd_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_glm2 &amp; </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = 'bottom',</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#         legend.direction = 'horizontal') </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="nonlinear-decomposition-model-no-em-interaction" class="level4">
<h4 class="anchored" data-anchor-id="nonlinear-decomposition-model-no-em-interaction">Nonlinear decomposition model, no EM interaction</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1138</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>est2 <span class="ot">&lt;-</span> <span class="fu">cmest</span>(<span class="at">data =</span> simdat3, <span class="at">model =</span> <span class="st">"rb"</span>, <span class="at">outcome =</span> <span class="st">"Delinquency"</span>, <span class="at">exposure =</span> <span class="st">"ParentSupport"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">mediator =</span> <span class="st">"StrgMoralBlfs"</span>, <span class="at">EMint =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">mreg =</span> <span class="fu">list</span>(<span class="st">"linear"</span>), <span class="at">yreg =</span> <span class="st">"poisson"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">astar =</span> <span class="dv">0</span>, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">mval =</span> <span class="fu">list</span>(<span class="dv">0</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">estimation =</span> <span class="st">"imputation"</span>, <span class="at">inference =</span> <span class="st">"bootstrap"</span>, <span class="at">nboot =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(est2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Causal Mediation Analysis

# Outcome regression:

Call:
glm(formula = Delinquency ~ ParentSupport + StrgMoralBlfs, family = poisson(), 
    data = getCall(x$reg.output$yreg)$data, weights = getCall(x$reg.output$yreg)$weights)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     0.9852     0.0314    31.4   &lt;2e-16 ***
ParentSupport  -0.3954     0.0113   -34.9   &lt;2e-16 ***
StrgMoralBlfs  -0.4157     0.0101   -41.3   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 14602  on 9999  degrees of freedom
Residual deviance: 10782  on 9997  degrees of freedom
AIC: 22597

Number of Fisher Scoring iterations: 5


# Mediator regressions: 

Call:
glm(formula = StrgMoralBlfs ~ ParentSupport, family = gaussian(), 
    data = getCall(x$reg.output$mreg[[1L]])$data, weights = getCall(x$reg.output$mreg[[1L]])$weights)

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    3.23903    0.00863   375.3   &lt;2e-16 ***
ParentSupport  0.22216    0.00867    25.6   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 0.745)

    Null deviance: 7934.5  on 9999  degrees of freedom
Residual deviance: 7445.3  on 9998  degrees of freedom
AIC: 25435

Number of Fisher Scoring iterations: 2


# Effect decomposition on the rate ratio scale via the regression-based approach
 
Direct counterfactual imputation estimation with 
 bootstrap standard errors, percentile confidence intervals and p-values 
 
      Estimate Std.error  95% CIL 95% CIU  P.val    
Rcde  0.673378  0.008759 0.662008   0.690 &lt;2e-16 ***
Rpnde 0.673378  0.008759 0.662008   0.690 &lt;2e-16 ***
Rtnde 0.673378  0.008759 0.662008   0.690 &lt;2e-16 ***
Rpnie 0.911793  0.004673 0.904133   0.919 &lt;2e-16 ***
Rtnie 0.911793  0.004673 0.904133   0.919 &lt;2e-16 ***
Rte   0.613981  0.007729 0.602954   0.628 &lt;2e-16 ***
pm    0.153869  0.009871 0.139542   0.173 &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Rcde: controlled direct effect rate ratio; Rpnde: pure natural direct effect rate ratio; Rtnde: total natural direct effect rate ratio; Rpnie: pure natural indirect effect rate ratio; Rtnie: total natural indirect effect rate ratio; Rte: total effect rate ratio; pm: overall proportion mediated)

Relevant variable values: 
$a
[1] 1

$astar
[1] 0

$mval
$mval[[1]]
[1] 0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcmest</span>(est2) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modmadness-pt2-wd_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="nonlinear-decomposition-model-with-em-interaction" class="level4">
<h4 class="anchored" data-anchor-id="nonlinear-decomposition-model-with-em-interaction">Nonlinear decomposition model, with EM interaction</h4>
<p>Effect of moving from min A (0) to max A (4)</p>
<p>Figure out how to limit output (drop proportion values; see effect.pe)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1138</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>est2 <span class="ot">&lt;-</span> <span class="fu">cmest</span>(<span class="at">data =</span> simdat2, <span class="at">model =</span> <span class="st">"rb"</span>, <span class="at">outcome =</span> <span class="st">"Delinquency"</span>, <span class="at">exposure =</span> <span class="st">"ParentSupport"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">mediator =</span> <span class="st">"StrgMoralBlfs"</span>, <span class="at">EMint =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">mreg =</span> <span class="fu">list</span>(<span class="st">"linear"</span>), <span class="at">yreg =</span> <span class="st">"poisson"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">astar =</span> <span class="dv">0</span>, <span class="at">a =</span> <span class="dv">4</span>, <span class="at">mval =</span> <span class="fu">list</span>(<span class="dv">0</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">estimation =</span> <span class="st">"imputation"</span>, <span class="at">inference =</span> <span class="st">"bootstrap"</span>, <span class="at">nboot =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(est2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Causal Mediation Analysis

# Outcome regression:

Call:
glm(formula = Delinquency ~ ParentSupport + StrgMoralBlfs + ParentSupport * 
    StrgMoralBlfs, family = poisson(), data = getCall(x$reg.output$yreg)$data, 
    weights = getCall(x$reg.output$yreg)$weights)

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  1.25227    0.05005   25.02  &lt; 2e-16 ***
ParentSupport               -0.51010    0.03578  -14.26  &lt; 2e-16 ***
StrgMoralBlfs               -0.37998    0.01209  -31.42  &lt; 2e-16 ***
ParentSupport:StrgMoralBlfs  0.03063    0.00908    3.37  0.00074 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 14602  on 9999  degrees of freedom
Residual deviance: 10782  on 9996  degrees of freedom
AIC: 22598

Number of Fisher Scoring iterations: 5


# Mediator regressions: 

Call:
glm(formula = StrgMoralBlfs ~ ParentSupport, family = gaussian(), 
    data = getCall(x$reg.output$mreg[[1L]])$data, weights = getCall(x$reg.output$mreg[[1L]])$weights)

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    4.23734    0.00870   487.2   &lt;2e-16 ***
ParentSupport  0.22409    0.00874    25.6   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 0.757)

    Null deviance: 8061.6  on 9999  degrees of freedom
Residual deviance: 7563.9  on 9998  degrees of freedom
AIC: 25593

Number of Fisher Scoring iterations: 2


# Effect decomposition on the rate ratio scale via the regression-based approach
 
Direct counterfactual imputation estimation with 
 bootstrap standard errors, percentile confidence intervals and p-values 
 
               Estimate Std.error  95% CIL 95% CIU  P.val    
Rcde            0.12998   0.02632  0.09456   0.179 &lt;2e-16 ***
Rpnde           0.21203   0.01054  0.20141   0.234 &lt;2e-16 ***
Rtnde           0.23664   0.01435  0.21707   0.265 &lt;2e-16 ***
Rpnie           0.71135   0.01440  0.69149   0.733 &lt;2e-16 ***
Rtnie           0.79392   0.04056  0.73357   0.863 &lt;2e-16 ***
Rte             0.16833   0.01060  0.15652   0.190 &lt;2e-16 ***
ERcde          -4.11655   0.19494 -4.41013  -3.787 &lt;2e-16 ***
ERintref        3.32858   0.19640  3.00562   3.621 &lt;2e-16 ***
ERintmed        0.24496   0.01069  0.22640   0.262 &lt;2e-16 ***
ERpnie         -0.28865   0.01440 -0.30849  -0.267 &lt;2e-16 ***
ERcde(prop)     4.94975   0.22742  4.60976   5.313 &lt;2e-16 ***
ERintref(prop) -4.00229   0.23121 -4.36841  -3.658 &lt;2e-16 ***
ERintmed(prop) -0.29454   0.01354 -0.31788  -0.271 &lt;2e-16 ***
ERpnie(prop)    0.34708   0.01683  0.32078   0.375 &lt;2e-16 ***
pm              0.05254   0.01105  0.03465   0.069 &lt;2e-16 ***
int            -4.29682   0.23993 -4.68597  -3.931 &lt;2e-16 ***
pe             -3.94975   0.22742 -4.31336  -3.610 &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Rcde: controlled direct effect rate ratio; Rpnde: pure natural direct effect rate ratio; Rtnde: total natural direct effect rate ratio; Rpnie: pure natural indirect effect rate ratio; Rtnie: total natural indirect effect rate ratio; Rte: total effect rate ratio; ERcde: excess relative rate due to controlled direct effect; ERintref: excess relative rate due to reference interaction; ERintmed: excess relative rate due to mediated interaction; ERpnie: excess relative rate due to pure natural indirect effect; ERcde(prop): proportion ERcde; ERintref(prop): proportion ERintref; ERintmed(prop): proportion ERintmed; ERpnie(prop): proportion ERpnie; pm: overall proportion mediated; int: overall proportion attributable to interaction; pe: overall proportion eliminated)

Relevant variable values: 
$a
[1] 4

$astar
[1] 0

$mval
$mval[[1]]
[1] 0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcmest</span>(est2) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>(<span class="at">xlim =</span> <span class="cn">NULL</span>, <span class="at">ylim =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="cn">TRUE</span>, <span class="at">clip =</span> <span class="st">"on"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modmadness-pt2-wd_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Remember <a href="https://reluctantcriminologists.com/blog-posts/%5B6%5D/modmadness-pt1#two-papers-walk-into-a-bar">hypothetical paper #1</a> from Moderator Madness, Part 1?<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Remember <a href="https://reluctantcriminologists.com/blog-posts/%5B6%5D/modmadness-pt1#two-papers-walk-into-a-bar">hypothetical paper #2</a> from Moderator Madness, Part 1?<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Are you wondering what the (Y11 - Y10 - Y01 + Y00) term represents? Well, you can think of it as contrasting the effect of X (i.e., doing X=1 - doing X=0) in the mechanism’s presence (M=1) versus its absence (M=0). Alternatively, you can also think of it as contrasting the effect of M (i.e,. doing M=1 - doing M=0) in the exposure’s presence (X=1) versus its absence (X=0). Let’s use the latter to show our work:<br>
(Effect of M | X=1) - (Effect of M | X=0)<br>
= (Y11 - Y10) - (Y01 - Y00)<br>
From here, we just do a bit of basic algebra:<br>
= Y11 - Y10 + (-1)(Y01 - Y00)<br>
= Y11 - Y10 - Y01 + Y00<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Similar, but not identical. For instance, I reduced the magnitude of a coefficient (from -0.5 to -0.3) to weaken the causal effect of parental support on moral beliefs, which moves it closer to the range of plausible effect sizes of many theorized causes of attitudes and behaviors observed in criminology.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Note that the Y(do[X=1],do[M<sub>X=0</sub>]) may be an unobservable counterfactual condition (e.g., in the presence of mediation). We cannot in fact simultaneously observe Y with X set to =1 and M set to equal its expected value when X=0. After all, if we do X=1 and X has an effect on M, then M would also change to its (population average) value at X=1; M would not stay at its expected value when X=0! <a href="https://www.nimhd.nih.gov/docs/hd-workshop/day1/roleWorkInHD-2020_10_kaufman_mediationAnalysesToRacialEthnic.pdf">These slides</a> (especially slide 12) offer a concise description of this issue.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{brauer2024,
  author = {Brauer, Jon},
  title = {Moderator {Madness,} {Part} 2},
  date = {2024-01-30},
  url = {https://reluctantcriminologists.com/blog-posts/[7]/modmadness-pt2.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-brauer2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Brauer, Jon. 2024. <span>“Moderator Madness, Part 2.”</span> January 30,
2024. <a href="https://reluctantcriminologists.com/blog-posts/[7]/modmadness-pt2.html">https://reluctantcriminologists.com/blog-posts/[7]/modmadness-pt2.html</a>.
</div></div></section></div></main> <!-- /main -->
<div>
<hr>

<p> questions? feedback? want to connect? </p>


<table data-quarto-postprocess="true" width="100%" data-cellspacing="0" data-cellpadding="0" class="table">
<colgroup>
<col style="width: 100%">
</colgroup>
<tbody>
<tr class="odd">
<td><table data-quarto-postprocess="true" data-cellspacing="0" data-cellpadding="0" class="table">
<tbody>
<tr class="odd">
<td style="border-radius: 2px" data-bgcolor="#93c54b"><a href="mailto:reluctantcrim@gmail.com" target="_blank" style="padding: 8px 12px; border: 1px solid #93c54b;border-radius: 2px;font-family: Helvetica, Arial, sans-serif;font-size: 14px; color: #000000;text-decoration: none;font-weight:bold;display: inline-block;">send us an email</a></td>
</tr>
</tbody>
</table></td>
</tr>
</tbody>
</table>


<hr>
</div>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="jakeday4/reluctantcrim_comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://reluctantcriminologists.com/">
      <i class="bi bi-house-fill" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:reluctantcrim@gmail.com">
      <i class="bi bi-envelope-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jakeday4/reluctantcrim_website">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/reluctantcrim">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>